"use strict";var _objectHasOwn=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(e),t)};function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}define("bagsdk/global",[],(function(){return window})),define("bagsdk/utils/getInstanceEventBus",["jquery"],(function(e){if("function"==typeof e)return e({})})),define("bagsdk/utils/sdkInstanceAsyncLoader",["bagsdk/utils/getInstanceEventBus"],(function(e){var t={load:function(t,n,i,o){o.isBuild?i(t):(e.bagSdkInstantiated&&i(t),e.on("bagSdk:instanceReady",(function(){i(t)})))}};return t})),define("Asos.Commerce.Bag.Sdk",["bagsdk/global","bagsdk/utils/sdkInstanceAsyncLoader!dummyModuleName"],(function(e){return["asos","commerce","_bagSdkInstance"].reduce((function(e,t){if(void 0!==e)return e[t]}),e)})),define("bagsdk/config/configuration",[],(function(){return{}})),define("bagsdk/config/defaultConfiguration",["bagsdk/global"],(function(e){return{postMessageUrl:"https://"+e.location.hostname+"/bag/gateway/",bagApiUrl:"https://"+e.location.hostname+"/api",xSiteOrigin:null}})),define("bagsdk/config/currencies",[],(function(){return{"COM:GBP":"£0.00","COM:USD":"$0.00","COM:CAD":"C$0.00","COM:SEK":"SEK0.00","COM:NOK":"NOK0.00","COM:DKK":"DKK0.00","COM:CHF":"CHF0.00","COM:EUR":"€0.00","COM:AUD":"$0.00","COM:RMB":"¥0.00","COM:HKD":"HKD$0.00","COM:NZD":"NZD$0.00","COM:SGD":"SGD$0.00","COM:TWD":"NT$0.00","COM:RUB":"руб. 0.00","US:GBP":"£0.00","US:USD":"$0.00","US:CAD":"C$0.00","US:SEK":"SEK0.00","US:NOK":"NOK0.00","US:DKK":"DKK0.00","US:CHF":"CHF0.00","US:EUR":"€0.00","US:AUD":"$0.00","US:RMB":"¥0.00","US:HKD":"HKD$0.00","US:NZD":"NZD$0.00","US:SGD":"SGD$0.00","US:TWD":"NT$0.00","US:RUB":"руб. 0.00","FR:GBP":"0,00 £","FR:USD":"0,00 $","FR:CAD":"0,00 C$","FR:SEK":"0,00 SEK","FR:NOK":"0,00 NOK","FR:DKK":"0,00 DKK","FR:CHF":"0,00 CHF","FR:EUR":"0,00 €","FR:AUD":"0,00 $","FR:RMB":"0,00 ¥","FR:HKD":"0,00 HKD$","FR:NZD":"0,00 NZD$","FR:SGD":"0,00 SGD$","FR:TWD":"0,00 NT$","FR:RUB":"0,00 руб.","DE:GBP":"0,00 £","DE:USD":"0,00 $","DE:CAD":"0,00 C$","DE:SEK":"0,00 SEK","DE:NOK":"0,00 NOK","DE:DKK":"0,00 DKK","DE:CHF":"0,00 CHF","DE:EUR":"0,00 €","DE:AUD":"0,00 $","DE:RMB":"0,00 ¥","DE:HKD":"0,00 HKD$","DE:NZD":"0,00 NZD$","DE:SGD":"0,00 SGD$","DE:TWD":"0,00 NT$","DE:RUB":"0,00 руб.","IT:GBP":"£ 0,00","IT:USD":"$ 0,00","IT:CAD":"C$ 0,00","IT:SEK":"SEK 0,00","IT:NOK":"NOK 0,00","IT:DKK":"DKK 0,00","IT:CHF":"CHF 0,00","IT:EUR":"€ 0,00","IT:AUD":"$ 0,00","IT:RMB":"¥ 0,00","IT:HKD":"HKD$ 0,00","IT:NZD":"NZD$ 0,00","IT:SGD":"SGD$ 0,00","IT:TWD":"NT$ 0,00","IT:RUB":"руб. 0,00","ES:GBP":"0,00 £","ES:USD":"0,00 $","ES:CAD":"0,00 C$","ES:SEK":"0,00 SEK","ES:NOK":"0,00 NOK","ES:DKK":"0,00 DKK","ES:CHF":"0,00 CHF","ES:EUR":"0,00 €","ES:AUD":"0,00 $","ES:RMB":"0,00 ¥","ES:HKD":"0,00 HKD$","ES:NZD":"0,00 NZD$","ES:SGD":"0,00 SGD$","ES:TWD":"0,00 NT$","ES:RUB":"0,00 руб.","AU:GBP":"£0.00","AU:USD":"$0.00","AU:CAD":"C$0.00","AU:SEK":"SEK0.00","AU:NOK":"NOK0.00","AU:DKK":"DKK0.00","AU:CHF":"CHF0.00","AU:EUR":"€0.00","AU:AUD":"$0.00","AU:RMB":"¥0.00","AU:HKD":"HKD$0.00","AU:NZD":"NZD$0.00","AU:SGD":"SGD$0.00","AU:TWD":"NT$0.00","AU:RUB":"руб. 0.00","RU:GBP":"0,00£","RU:USD":"0,00$","RU:CAD":"0,00C$","RU:SEK":"0,00SEK","RU:NOK":"0,00NOK","RU:DKK":"0,00DKK","RU:CHF":"0,00CHF","RU:EUR":"0,00€","RU:AUD":"0,00$","RU:RMB":"0,00¥","RU:HKD":"0,00HKD$","RU:NZD":"0,00NZD$","RU:SGD":"0,00SGD$","RU:TWD":"0,00NT$","RU:RUB":"0,00 руб."}})),define("bagsdk/models/apiService",["jquery","uuid","bagsdk/config/configuration","bagsdk/global"],(function(e,t,n,i){function o(t){this.defaultOptions={contentType:"application/json",dataType:"json",headers:{"asos-c-plat":"Web","asos-c-name":"Asos.Commerce.Bag.Sdk","asos-c-ver":"8.0.457","asos-c-istablet":!1,"asos-c-ismobile":!1}},e.extend(!0,this.defaultOptions,t)}return o.prototype.setupRequestAjaxOptions=function(i,o,r){return i=e.extend(!0,{url:"",headers:{"asos-cid":t()}},this.defaultOptions,i||{}),n.xSiteOrigin&&o.withParam("x-site-origin",n.xSiteOrigin),i.type=o.method.toUpperCase(),i.url+=o.path,"object"===_typeof(r)&&Object.keys(r).length&&(i.data=JSON.stringify(r)),i},o.prototype.successfulResponseHandler=function(e){return e},o.prototype.failedResponseHandler=function(e){var t=e.getResponseHeader("content-type")||e.getResponseHeader("Content-Type"),n=e.getResponseHeader("asos-bag-session-token");return 403===e.status&&Array.isArray(e.responseJSON)&&e.responseJSON.some((function(e){return"NotAuthorisedForProduct"===e.errorCode}))?[{errorCode:"NotAuthorisedForProduct"}]:401===e.status||403===e.status?[{errorCode:"BagDoesNotExist"}]:500===e.status&&""===n?[{errorCode:"BagSessionTokenIsInvalid"}]:t&&-1!==t.indexOf("json")?JSON.parse(e.responseText):t&&-1!==t.indexOf("plain")&&e.responseText?e.responseText:""},o.prototype.jQueryTransport=function(t){return new Promise(function(n,i){e.ajax(t).done(function(){n(this.successfulResponseHandler.apply(this,arguments))}.bind(this)).fail(function(){i(this.failedResponseHandler.apply(this,arguments))}.bind(this))}.bind(this))},o.prototype.request=function(e,t,n){var o=this.setupRequestAjaxOptions(n,e,t);return i.newrelic&&i.newrelic.interaction().save(),this.jQueryTransport(o)},o})),define("bagsdk/services/identityService",["require","asos.identity.events","asos.identity.sdk.supportedEventTypes"],(function(e,t,n){var i=function(){return new Promise((function(t){e(["Asos.Identity.Web.ClientSdk"],(function(e){t(e)}))}))};return{customerGuid:function(){return i().then((function(e){return e.customer.customerGuid()}))},customerId:function(){return i().then((function(e){return e.customer.customerId()}))},getAccessToken:function(){return i().then((function(e){return e.getAccessToken()}))},isAuthenticated:function(){return i().then((function(e){return e.customer.isAuthenticated()}))},login:function(){return i().then((function(e){return e.login()}))},onSessionEnded:function(e){t.subscribe(n.onSessionEnded,e)},onLoggedIn:function(e){t.subscribe(n.onLoggedIn,e)},customerUniqueId:function(){return i().then((function(e){return e.ready().then((function(t){return e.customer.profile().then((function(n){return void 0===n||n.isAnonymous?e.customer.customerGuid():n.customerAid||t._oidcTokenManager._token.profile.aid}))}))}))}}})),define("bagsdk/exceptions/bagSdkException",[],(function(){function e(e,t){return!!Array.isArray(e)&&e.some((function(e){return e.errorCode===t}))}function t(t){this.name="BagSdkException",this.message=t,this.stack=(new Error).stack,this.bagStateInvalid=e(t,"BagItemDoesNotExist")||e(t,"ProductNotAvailableFromProductService")}return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t})),define("bagsdk/factories/memoryCacheFactory",[],(function(){var e={};function t(e){this.storage=e}return t.prototype.getItem=function(e){var t,n=this.storage[e];return n&&(n.expires>(new Date).getTime()||!n.expires?t=n.value:(delete this.storage[e],t=null)),t},t.prototype.removeItem=function(e){this.storage[e]&&delete this.storage[e]},t.prototype.setItem=function(e,t,n){var i=1e3*n||0;this.storage[e]={value:t,expires:i?(new Date).getTime()+i:i}},t.prototype.clear=function(){this.storage={}},function(){return{application:new t(e),instance:new t({})}}})),define("global",[],(function(){return window})),define("bagsdk/services/persistedDataService",["global"],(function(e){function t(e){this.storage=e,this.storageKey="Asos.Commerce.Bag.Sdk",this.cleanCache()}return t.prototype.cleanCache=function(){var e=this.getStorageItem(),t={};for(var n in e)if(_objectHasOwn(e,n)){var i=e[n];_objectHasOwn(i,"expires")&&i.expires>(new Date).getTime()&&(t[n]=i)}this._setStorageItem(this.storageKey,JSON.stringify(t))},t.prototype.getStorageItem=function(){var e=this.storage.getItem(this.storageKey);return e?JSON.parse(e):{}},t.prototype.getItem=function(e){var t=this.getStorageItem();if(_objectHasOwn(t,e)){var n=t[e];if(n.expires>(new Date).getTime())return n.data;this.deleteItem(e)}return null},t.prototype.setItem=function(e,t,n){n=void 0===n?36e5:n;var i=this.getStorageItem();i[e]={data:t,expires:(new Date).getTime()+n},this._setStorageItem(this.storageKey,JSON.stringify(i))},t.prototype.deleteItem=function(e){var t=this.getStorageItem();delete t[e],this._setStorageItem(this.storageKey,JSON.stringify(t))},t.prototype.clear=function(){this._setStorageItem(this.storageKey,JSON.stringify({}))},t.prototype._setStorageItem=function(t,n){try{this.storage.setItem(t,n)}catch(t){e.console.warn("Error setting localStorage:",t)}},new t(e.localStorage)})),define("bagsdk/services/cookieService",["bagsdk/global","jquery"],(function(e,t){function n(){return new Date}function i(){var t=new RegExp(/(?:.)*?\.?asos(.+)/);return e.location.hostname.replace(t,"asos$1")}function o(t,o,r){var a=i(),s="";if(r){var u=n();u.setTime(u.getTime()+24*r*60*60*1e3),s="; expires="+u.toGMTString()}e.document.cookie=t+"="+o+s+";path=/;domain="+a}var r=function(e,n,i){var o={};if(e)for(var r=e.split(n),a=0;a<r.length;a++){var s=r[a].indexOf(i);o[t.trim(r[a].substr(0,s))]=r[a].substr(s+1)}return o},a=function(t){var n=r(e.document.cookie,";","="),i="";return t in n&&(i=n[t]),decodeURIComponent(i)};return{readCookie:a,writeToCookie:function(e,t,n,i){var s=function(e){var t=a(e);return r(t,"&","=")}(e);s[t]=encodeURIComponent(n);var u=function(e,t,n){var i=[];for(var o in e)_objectHasOwn(e,o)&&i.push(o+n+e[o]);return i.join(t)}(s,"&","=");o(e,u,i)},writeCookie:function(e,t,n){o(e,t,n)},getCookieDomain:i,getDate:n,invalidateCookieByPrefix:function(t){e.document.cookie.split(/;\s*/).filter((function(e){return e.match(t+"[^=]*=")})).forEach(function(e){var t=e.split("=")[0];this.writeCookie(t,"null",-1)}.bind(this))}}})),define("bagsdk/services/bagApiService",["bagsdk/models/apiService","bagsdk/services/identityService","bagsdk/exceptions/bagSdkException","bagsdk/factories/memoryCacheFactory","bagsdk/services/persistedDataService","bagsdk/services/cookieService"],(function(e,t,n,i,o,r){function a(t){e.call(this,{url:t.bagApiUrl,headers:{"asos-c-store":t.store}}),this.memoryCache=i(),this.keyCreator=t.keyCreator;var n=null,a=null;this.setBagId=function(e){var t=this.keyCreator.createCookieKey("BagId");n=e,r.writeCookie(t,e,2/24)},this.readLastModifiedCookie=function(){var e=this.keyCreator.createCookieKey("BagLastModified"),t=parseInt(r.readCookie(e),10);return isNaN(t)?null:t},this.setLastModifiedCookie=function(e,t){var n=this.keyCreator.createCookieKey("BagLastModified");a=e,r.writeCookie(n,a,t)},this.updatePersistedLastModified=function(e){var t=this.keyCreator.createPersistedDataKey({customerUniqueId:e,keyName:"bagLastModified"}),n=Date.now();o.setItem(t,n),this.setLastModifiedCookie(n,1/24)},this.getBagId=function(){return n},this.setOrigin=function(e){r.writeCookie("BagOrigin",e,2/24)},this.getOrigin=function(){return r.readCookie("BagOrigin")||null},this.setSessionToken=function(e){r.writeCookie("asos-bag-session-token",e)},this.getSessionToken=function(){return r.readCookie("asos-bag-session-token")||null}}return a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.prototype.setupRequestAjaxOptions=function(){var t=e.prototype.setupRequestAjaxOptions.apply(this,arguments),n=this.getOrigin();n&&(t.headers=t.headers||{},t.headers["asos-bag-origin"]=n);var i=this.getSessionToken();return i&&(t.headers=t.headers||{},t.headers["asos-bag-session-token"]=i),t},a.prototype.successfulResponseHandler=function(e,t,n){var i=function(e,t){return e.bag&&e.bag.origin?e.bag.origin:t.getResponseHeader("asos-bag-origin")}(e,n);i&&this.setOrigin(i);var o=n.getResponseHeader("asos-bag-session-token");o&&this.setSessionToken(o);var r=function(e){return e.bag&&e.bag.id?e.bag.id:e.bagId}(e);return r&&this.setBagId(r),e},a.prototype.exceptionHandler=function(e){throw Array.isArray(e)?(e[0]&&"BagSessionTokenIsInvalid"===e[0].errorCode&&r.invalidateCookieByPrefix("asos-bag-session-token"),new n(e)):new Error(e)},a.prototype.request=function(n,i,a){return Promise.all([t.getAccessToken(),t.customerUniqueId()]).then(function(t){var s=t[0],u=t[1],c={headers:{Authorization:"Bearer "+s}};return a&&(c.headers["asos-bag-product-authorization"]=a),e.prototype.request.call(this,n,i,c).then(function(e){var t=(e=e||{}).bag?e.bag.summary:e,n=!!e.bag;if(function(e){r.writeToCookie("asosbasket","basketitemcount",e.totalQuantity,1/24),r.writeToCookie("asosbasket","basketitemtotalretailprice",e.totalPrice?e.totalPrice.value:void 0,1/24)}(t),n){var i=this.keyCreator.createMemoryCacheKey({keyName:"bag"});this.memoryCache.application.setItem(i,e,20)}var a=this.keyCreator.createPersistedDataKey({customerUniqueId:u,keyName:"summary"}),s=this.keyCreator.createPersistedDataKey({customerUniqueId:u,keyName:"bagId"});return o.setItem(a,t,3e5),o.setItem(s,t.bagId,72e5),this.updatePersistedLastModified(u),e}.bind(this))}.bind(this)).catch(this.exceptionHandler.bind(this))},a})),define("bagsdk/config/routes",[],(function(){return{commerceBag:{createBagByCustomer:{path:"/commerce/bag/v4/customers/:guid/bags/getbag",method:"post"},getBagByCustomerAndStore:{path:"/commerce/bag/v4/customers/:guid/stores/:store/bag",method:"get"},getBagByCustomer:{path:"/commerce/bag/v4/customers/:guid/countries/:country/bag",method:"get"},getBagSummaryByCustomerAndStore:{path:"/commerce/bag/v4/customers/:guid/stores/:store/bag/total",method:"get"},getBagSummaryByCustomer:{path:"/commerce/bag/v4/customers/:guid/countries/:country/bag/total",method:"get"},getBagById:{path:"/commerce/bag/v4/bags/:bagId",method:"get"},getBagSummaryById:{path:"/commerce/bag/v4/bags/:bagId/total",method:"get"},addVariant:{path:"/commerce/bag/v4/bags/:bagId/product",method:"post"},removeItem:{path:"/commerce/bag/v4/bags/:bagId/product/:itemId",method:"delete"},removeSubscription:{path:"/commerce/bag/v4/bags/:bagId/subscription/:itemId",method:"delete"},removeVoucher:{path:"/commerce/bag/v4/bags/:bagId/vouchers/:itemId",method:"delete"},updateItem:{path:"/commerce/bag/v4/bags/:bagId/product/:itemId/update",method:"post"},moveToBag:{path:"/commerce/bag/v4/bags/:bagId/products/save",method:"post"},saveBag:{path:"/commerce/bag/v4/bags/:bagId/items/save",method:"post"},saveBagItem:{path:"/commerce/bag/v4/bags/:bagId/items/:itemId/save",method:"post"},updateCurrency:{path:"/commerce/bag/v4/bags/:bagId/currency",method:"put"},setDeliveryOption:{path:"/commerce/bag/v4/bags/:bagId/deliveryoptions",method:"put"},addVoucher:{path:"/commerce/bag/v4/bags/:bagId/vouchers",method:"post"},updateVoucher:{path:"/commerce/bag/v4/bags/:bagId/vouchers/:itemId",method:"put"},addSubscription:{path:"/commerce/bag/v4/bags/:bagId/subscription",method:"post"}}}})),define("bagsdk/models/route",["bagsdk/global"],(function(e){function t(e,t){this.path=e,this.method=t}return t.prototype.withExpansions=function(t){return this.path=function(n){if(-1===n.indexOf("?")?n+="?":n+="&",n+="expand=",Array.isArray(t)){for(var i=0;i<t.length-1;i++)n+=e.escape(t[i])+",";n+=e.escape(t[t.length-1])}else n+=e.escape(t);return n}(this.path),this},t.prototype.withParam=function(t,n){var i;return this.path=(-1===(i=this.path).indexOf("?")?i+="?":i+="&",i+=e.escape(t)+"="+e.escape(n)),this},t})),define("bagsdk/services/routeService",["bagsdk/config/routes","bagsdk/models/route"],(function(e,t){var n=e.commerceBag;return{createRoute:function(i,o,r){var a=function(t){var i=n;if(t&&t.routeCollection){if(!e[t.routeCollection])throw new Error('Unknown routeCollection "'+t.routeCollection+'".');i=e[t.routeCollection]}return i}(r)[i];if(!a)throw new Error('Unknown route "'+i+'".');return new t(function(e,t){var n,i=e;for(var o in t)_objectHasOwn(t,o)&&(n=new RegExp(":"+o,"g"),i=i.replace(n,t[o]));return i}(a.path,o),a.method)}}})),define("bagsdk/services/notificationService",["jquery"],(function(e){var t="addToBag:",n="completed",i={addEventStart:t+"started",addEventCompleted:t+n,addEventError:t+"error",updateEventCompleted:"bagUpdated:"+n};function o(t,n,i){e(t).trigger(n,i)}function r(){}return r.prototype.notifyItemAddedToBagStart=function(e,t){o(e,i.addEventStart,t)},r.prototype.notifyItemAddedToBagComplete=function(e,t,n){o(e,i.addEventCompleted,[t,n])},r.prototype.notifyItemAddedToBagError=function(e,t){o(e,i.addEventError,t)},r.prototype.notifyBagUpdatedComplete=function(e,t,n,r){o(e,i.updateEventCompleted,[t,n,r])},new r})),define("bagsdk/utils/comparer",[],(function(){var e=function(e,t){var n=Object.keys(e),i=Object.keys(t);return n.length===i.length&&n.every((function(n){return e[n]===t[n]}))};return{areConfigurationsEqual:function(t,n){return e(t,n)},areContextsEqual:function(t,n){return e(t,n)}}})),define("bagsdk/utils/keyCreator",[],(function(){function e(e,t,n){this._storeId=e,this._country=t,this._enableStoreBaseOperation=n}var t=function(e){return e.join(":::")};return e.prototype.createMemoryCacheKey=function(e){var n=[];return this._enableStoreBaseOperation||n.push(this._storeId),n.push(this._country),n.push(e.keyName),t(n)},e.prototype.createPersistedDataKey=function(e){var n=[];return n.push(e.customerUniqueId),n.push(this._storeId),this._enableStoreBaseOperation||n.push(this._country),n.push(e.keyName),t(n)},e.prototype.createCookieKey=function(e){var t=[];return t.push(e),t.push(this._storeId),this._enableStoreBaseOperation||t.push(this._country),t.join(":")},e})),define("bagsdk/exceptions/bagSdkSingleInstanceMismatchError",["./bagSdkException"],(function(e){function t(){this.name="BagSdkSingleInstanceMismatchError",this.stack=(new Error).stack}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t})),define("bagsdk/exceptions/argumentError",["./bagSdkException"],(function(e){function t(e){this.name="ArgumentError",this.message=e,this.stack=(new Error).stack}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t})),define("bagSdk/sdk",["bagsdk/config/configuration","bagsdk/config/defaultConfiguration","bagsdk/config/currencies","bagsdk/services/bagApiService","bagsdk/factories/memoryCacheFactory","bagsdk/services/cookieService","bagsdk/services/identityService","bagsdk/services/routeService","bagsdk/services/persistedDataService","bagsdk/services/notificationService","bagsdk/utils/comparer","bagsdk/utils/keyCreator","bagsdk/utils/getInstanceEventBus","bagsdk/global","jquery","bagsdk/exceptions/bagSdkSingleInstanceMismatchError","bagsdk/exceptions/argumentError"],(function(e,t,n,i,o,r,a,s,u,c,d,h,g,p,m,f,l){var y={deliveryOptions:"getdeliveryoptions",summary:"summary",total:"total",variants:"variants"};function b(e){var t=[y.summary,y.total];return void 0!==e&&(t=t.concat(e)),t}function v(e,t){return null===t&&null===e||("object"!==_typeof(t)||null!==e)&&((null!==t||"object"!==_typeof(e))&&t.id===e.id)}function I(e,t){if(void 0===e.seller)return!1;for(var n=t.bag.items,i=0;i<n.length;i++)if(n[i].variantId===e.variantId){var o=n[i].seller;return void 0!==o&&!v(e.seller,o)}}function C(e){for(var t=e.bag.items,n=0;n<t.length;n++)if(t[n].isHotProduct)return!0;return!1}function S(t){this._context=t,this._keyCreator=new h(t.storeId,t.country,t.enableStoreBasedOperation),this._bagApiService=new i({keyCreator:this._keyCreator,bagApiUrl:e.bagApiUrl,store:this._context.storeId}),this._memoryCache=o(),this._bindEventSubscriptions(),this._bagIdCookieKey=this._keyCreator.createCookieKey("BagId"),this._bagOriginCookieKey="BagOrigin",this._lastModifiedCookieKey=this._keyCreator.createCookieKey("BagLastModified"),this._keyStoreDataVersionKey="asos-b-sdv629",this._googleAnalyticsClientIdCookieName="asos-b-gat251",this._existingDataVersionCookie=r.readCookie(this._keyStoreDataVersionKey),this._computeKeyStoreDataVersion(),this._handlePendingHotProduct()}S.prototype._expansions=y,S.prototype._bindEventSubscriptions=function(){a.onSessionEnded(this._handleLogout.bind(this)),a.onLoggedIn(this._handleLogin.bind(this))},S.prototype._getUniqueUrlValue=function(){return(new Date).getTime()},S.prototype.version="8.0.457",S.prototype._init=function(){return Promise.all([a.customerGuid(),a.customerUniqueId(),a.customerId()]).then(function(e){var t={customerGuid:e[0],customerUniqueId:e[1],customerId:e[2]},n=this._keyCreator.createPersistedDataKey({customerUniqueId:t.customerUniqueId,keyName:"bagId"}),i=u.getItem(n);return i||(i=r.readCookie(this._bagIdCookieKey)||null),t.bagId=i,t}.bind(this))},S.prototype._prepareBag=function(e){return new Promise(function(t,n){if(null===e.bagId)return this._createBag().then((function(n){e.bagId=n.bag.id,t(e)})).catch((function(e){n(e)}));t(e)}.bind(this))},S.prototype.getCustomerConfig=function(){return new Promise(function(e){e({country:this._context.originCountry,currency:this._context.currency})}.bind(this))},S.prototype._getCurrencyNillValueByStoreAndCurrencyCode=function(e,t){var i=[e=e||"",t=t||""].join(":");return _objectHasOwn(n,i)?n[i]:"0.00"},S.prototype._bagDoesNotExist=function(e){return!!(e&&"object"===_typeof(e)&&Array.isArray(e.message)&&e.message.filter((function(e){return"BagDoesNotExist"===e.errorCode||"BagDoesNotExistForCustomer"===e.errorCode})).length)},S.prototype._handleBagDoesNotExist=function(e,t){t&&this._bagDoesNotExist(e)&&this._invalidateCachesAndCookies(t)},S.prototype._invalidateCaches=function(e){["summary","bagId","bagLastModified","isLoggedIn"].forEach(function(t){var n=this._keyCreator.createPersistedDataKey({customerUniqueId:e,keyName:t});u.deleteItem(n)}.bind(this))},S.prototype._invalidateCachesAndCookies=function(e){e?this._invalidateCaches(e):u.clear(),r.invalidateCookieByPrefix("BagId"),r.invalidateCookieByPrefix("BagLastModified"),r.invalidateCookieByPrefix("asos-bag-session-token"),p.asos.sdk=p.asos.sdk||{},p.asos.sdk.features&&p.asos.sdk.features.getFeature("bag-keep-bag-affinity-cookie").isEnabled()||r.invalidateCookieByPrefix("BagOrigin")},S.prototype.setSessionToken=function(e){this._bagApiService.setSessionToken(e)},S.prototype.getSessionToken=function(){return this._bagApiService.getSessionToken()},S.prototype.getOrCreateBag=function(e){return this.getBag().catch(function(t){if(this._bagDoesNotExist(t))return this._createBag(e);throw t}.bind(this))},S.prototype.getBag=function(e){var t=this._memoryCache.application.getItem(this._keyCreator.createMemoryCacheKey({keyName:"bag"}));return t?new Promise((function(e){e(t)})):this._init().then(function(t){if(null!==t.bagId)return this._getBagById(t.bagId,e,t.customerUniqueId);var n=t.customerId||t.customerGuid;return this._getBagByCustomerId(n,e,t.customerUniqueId)}.bind(this))},S.prototype.getBagById=function(e,t){return this._init().then(function(n){return this._getBagById(e,t,n.customerUniqueId)}.bind(this))},S.prototype._getBagById=function(e,t,n){var i=s.createRoute("getBagById",{bagId:e}).withExpansions(b(t)).withParam("lang",this._context.language).withParam("cb",this._getUniqueUrlValue());return this._bagApiService.request(i).then(this._validateBagCurrency.bind(this,t)).then(function(e){return c.notifyBagUpdatedComplete(this,"bagRetrieved",e),e}.bind(this)).catch(function(e){throw this._handleBagDoesNotExist(e,n),e}.bind(this))},S.prototype.getBagByCustomer=function(e){return this._init().then(function(t){var n=t.customerId||t.customerGuid;return this._getBagByCustomerId(n,e,t.customerUniqueId)}.bind(this))},S.prototype._getBagByCustomerId=function(e,t,n){var i=this._constructGetBagByCustomerIdRoute(e,t);return this._bagApiService.request(i).then(this._validateBagCurrency.bind(this,t)).then(function(e){return c.notifyBagUpdatedComplete(this,"bagRetrieved",e),e}.bind(this)).catch(function(e){throw this._handleBagDoesNotExist(e,n),e}.bind(this))},S.prototype._constructGetBagByCustomerIdRoute=function(e,t){return(this._context.enableStoreBasedOperation?s.createRoute("getBagByCustomerAndStore",{guid:e,store:this._context.storeId}):s.createRoute("getBagByCustomer",{guid:e,country:this._context.country}).withParam("keyStoreDataversion",this._context.keyStoreDataversion)).withParam("lang",this._context.language).withParam("cb",this._getUniqueUrlValue()).withExpansions(b(t))},S.prototype._createBag=function(e){return this._init().then(function(t){var n={currency:this._context.currency,lang:this._context.language,sizeSchema:this._context.sizeSchema},i=s.createRoute("createBagByCustomer",{guid:t.customerId||t.customerGuid}).withExpansions(b(e)).withParam("lang",this._context.language);return this._context.enableStoreBasedOperation?(n.country=this._context.originCountry,n.store=this._context.storeId):(i.withParam("keyStoreDataversion",this._context.keyStoreDataversion),n.country=this._context.country,n.originCountry=this._context.originCountry),this._bagApiService.request(i,n)}.bind(this))},S.prototype._getCachedSummary=function(e){if(this._bagModified(e))return null;var t=this._keyCreator.createPersistedDataKey({customerUniqueId:e,keyName:"summary"});return u.getItem(t)},S.prototype._getCachedLastModified=function(e){var t=this._keyCreator.createPersistedDataKey({customerUniqueId:e,keyName:"bagLastModified"});return u.getItem(t)},S.prototype.getNillBagSummary=function(e){return{bagId:null,currency:e,totalPrice:{text:this._getCurrencyNillValueByStoreAndCurrencyCode(this._context.storeId,e),value:0},totalQuantity:0}},S.prototype._bagModified=function(e){return this._getCachedLastModified(e)!==this._bagApiService.readLastModifiedCookie()},S.prototype.getBagSummary=function(){var e=function(e){var t;if(null!==e.bagId)t=s.createRoute("getBagSummaryById",{bagId:e.bagId});else{var n={guid:e.customerId||e.customerGuid};!0===this._context.enableStoreBasedOperation?(n.store=this._context.storeId,t=s.createRoute("getBagSummaryByCustomerAndStore",n)):(n.country=this._context.country,(t=s.createRoute("getBagSummaryByCustomer",n)).withParam("keyStoreDataversion",this._context.keyStoreDataversion))}return t.withParam("lang",this._context.language).withParam("cb",this._getUniqueUrlValue()),t};return this._init().then(function(t){var n=this._getCachedSummary(t.customerUniqueId);if(n&&n.bagId===t.bagId)return n;var i=e.call(this,t);return this._bagApiService.request(i).catch(function(e){this._handleBagDoesNotExist(e,t.customerUniqueId);var n=this.getNillBagSummary(this._context.currency),i=this._keyCreator.createPersistedDataKey({customerUniqueId:t.customerUniqueId,keyName:"summary"});return u.setItem(i,n),n}.bind(this))}.bind(this)).then(this._validateBagSummaryCurrency.bind(this))};var k=function(e,t,n){var i={variantId:e,setTime:(new Date).getTime(),savedItemId:t,seller:n};return window.localStorage.setItem("pendingHotProductId",JSON.stringify(i)),a.login()},_=function(e,t,n){return this._init().then(this._prepareBag.bind(this)).then(function(i){var o=s.createRoute("addVariant",{bagId:i.bagId}).withExpansions(b(t)).withParam("lang",this._context.language),r={variantId:e.variantId};return this._bagApiService.request(o,r,e.productAuthorization).then(function(t){var i={sellerChanged:I(e,t),containsHotProduct:C(t)},o=m.extend({},n,i);return c.notifyItemAddedToBagComplete(this,t,o),c.notifyBagUpdatedComplete(this,"itemAdded",t,o),t}.bind(this)).catch(function(t){throw"NotAuthorisedForProduct"===t.message[0].errorCode?k.call(this,e.variantId,void 0,e.seller):this._handleBagDoesNotExist(t,i.customerUniqueId),t}.bind(this))}.bind(this))};S.prototype.addVariant=function(e,t,n){return new Promise(function(i,o){c.notifyItemAddedToBagStart(this,e.variantId);var r=_.bind(this,e,t,n);r().then(i).catch(function(e){this._bagDoesNotExist(e)?r().then(i).catch((function(e){c.notifyItemAddedToBagError(this,e),o(e)})):(c.notifyItemAddedToBagError(this,e),o(e))}.bind(this))}.bind(this))},S.prototype.removeItem=function(e,t,n){return this._init().then(this._prepareBag.bind(this)).then(function(i){var o;switch(t){case"subscription":o="removeSubscription";break;case"voucher":o="removeVoucher";break;default:o="removeItem"}var r=s.createRoute(o,{bagId:i.bagId,itemId:e}).withExpansions(b(n)).withParam("lang",this._context.language);return this._bagApiService.request(r).then(function(e){return c.notifyBagUpdatedComplete(this,"removeItem",e),e}.bind(this)).catch(function(e){throw this._handleBagDoesNotExist(e,i.customerUniqueId),e}.bind(this))}.bind(this))},S.prototype.updateItem=function(e,t,n,i){return this._init().then(this._prepareBag.bind(this)).then(function(o){var r={bagId:o.bagId,itemId:e},a=s.createRoute("updateItem",r).withExpansions(b(i)).withParam("lang",this._context.language);return this._bagApiService.request(a,{quantity:n,variantId:t}).then(function(e){return c.notifyBagUpdatedComplete(this,"updateItem",e),e}.bind(this)).catch(function(e){throw this._handleBagDoesNotExist(e,o.customerUniqueId),e}.bind(this))}.bind(this))};var B=function(e,t,n){return this._init().then(this._prepareBag.bind(this)).then(function(i){var o=s.createRoute("moveToBag",{bagId:i.bagId}).withExpansions(b(t)).withParam("lang",this._context.language),r=[{variantId:e.variantId}],a=parseInt(e.savedItemId,10);return isNaN(a)||(r[0].savedItemId=a),this._bagApiService.request(o,r).then(function(t){var i={sellerChanged:I(e,t),containsHotProduct:C(t)},o=m.extend({},n,i);return c.notifyItemAddedToBagComplete(this,t,o),c.notifyBagUpdatedComplete(this,"itemAdded",t,o),t}.bind(this)).catch(function(t){if("NotAuthorisedForProduct"===t.message[0].errorCode)return k.call(this,e.variantId,a,e.seller).then(function(){throw t}.bind(this));throw this._handleBagDoesNotExist(t,i.customerUniqueId),t}.bind(this))}.bind(this))};S.prototype.moveToBag=function(){var e,t,n;return"number"==typeof arguments[0]?((e={}).variantId=arguments[0],e.savedItemId=arguments[1],t=arguments[2],n=arguments[3]):(e=arguments[0],t=arguments[1],n=arguments[2]),new Promise(function(i,o){c.notifyItemAddedToBagStart(this,e.variantId);var r=B.bind(this,e,t,n);r().then(i).catch(function(e){this._bagDoesNotExist(e)?r().then(i).catch((function(e){c.notifyItemAddedToBagError(this,e),o(e)})):(c.notifyItemAddedToBagError(this,e),o(e))}.bind(this))}.bind(this))},S.prototype.saveBag=function(e){return this._init().then(this._prepareBag.bind(this)).then(function(t){var n={bagId:t.bagId},i=s.createRoute("saveBag",n).withExpansions(b(e)).withParam("lang",this._context.language);return this._bagApiService.request(i).then(function(e){return c.notifyBagUpdatedComplete(this,"saveBag",e),e}.bind(this)).catch(function(e){throw this._handleBagDoesNotExist(e,t.customerUniqueId),e}.bind(this))}.bind(this))},S.prototype.saveForLater=function(e,t){return this._init().then(this._prepareBag.bind(this)).then(function(n){var i={bagId:n.bagId,itemId:e},o=s.createRoute("saveBagItem",i).withExpansions(b(t)).withParam("lang",this._context.language);return this._bagApiService.request(o).then(function(e){return c.notifyBagUpdatedComplete(this,"saveForLater",e),e}.bind(this)).catch(function(e){throw this._handleBagDoesNotExist(e,n.customerUniqueId),e}.bind(this))}.bind(this))},S.prototype._computeKeyStoreDataVersion=function(){var e=this._context.keyStoreDataversion||"NO_KEY_STORE_DATAVERSION";this._existingDataVersionCookie!==e&&this._invalidateCachesAndCookies(),r.writeCookie(this._keyStoreDataVersionKey,e,.25)},S.prototype.updateCurrency=function(e,t){return this._init().then(function(n){if(!n.bagId)return new Promise(function(t){var i=this.getNillBagSummary(e),o=this._keyCreator.createPersistedDataKey({customerUniqueId:n.customerUniqueId,keyName:"summary"});u.setItem(o,i),this._context.currency=e,t(null)}.bind(this));var i={bagId:n.bagId},o=s.createRoute("updateCurrency",i).withExpansions(b(t)).withParam("lang",this._context.language);return this._bagApiService.request(o,{currency:e}).then(function(t){return this._context.currency=e,c.notifyBagUpdatedComplete(this,"updateCurrency",t),t}.bind(this)).catch(function(e){throw this._handleBagDoesNotExist(e,n.customerUniqueId),e}.bind(this))}.bind(this))},S.prototype.setDeliveryOption=function(e,t){return this._init().then(this._prepareBag.bind(this)).then(function(n){var i={bagId:n.bagId},o=s.createRoute("setDeliveryOption",i).withExpansions(y.deliveryOptions).withParam("lang",this._context.language),r={deliveryOptionId:e};return void 0!==t&&(r.nominatedDate=t),this._bagApiService.request(o,r).then(function(e){return c.notifyBagUpdatedComplete(this,"setDeliveryOption",e),e}.bind(this)).catch(function(e){throw this._handleBagDoesNotExist(e,n.customerUniqueId),e}.bind(this))}.bind(this))};var D=function(e,t,n,i,o,r,a){return this._init().then(this._prepareBag.bind(this)).then(function(u){var d={bagId:u.bagId},h=s.createRoute("addVoucher",d).withExpansions(b(a)).withParam("lang",this._context.language),g={Value:e,ToName:t,ToEmail:n,VoucherStyleId:i,DeliveryDate:o};return r&&(r.fromName&&(g.FromName=r.fromName),r.personalMessage&&(g.PersonalMessage=r.personalMessage)),this._bagApiService.request(h,g).then(function(e){return c.notifyBagUpdatedComplete(this,"addVoucher",e),e}.bind(this)).catch(function(e){throw this._handleBagDoesNotExist(e,u.customerUniqueId),e}.bind(this))}.bind(this))};S.prototype.addVoucher=function(e,t,n,i,o,r,a){return new Promise(function(s,u){var c=D.bind(this,e,t,n,i,o,r,a);c().then(s).catch(function(e){this._bagDoesNotExist(e)?c().then(s).catch(u):u(e)}.bind(this))}.bind(this))},S.prototype.updateVoucher=function(e,t,n,i,o,r,a,u){return this._init().then(this._prepareBag.bind(this)).then(function(d){var h={bagId:d.bagId,itemId:e},g=s.createRoute("updateVoucher",h).withExpansions(b(u)).withParam("lang",this._context.language),p={Value:t,ToName:n,ToEmail:i,VoucherStyleId:o,DeliveryDate:r};return a&&(a.fromName&&(p.FromName=a.fromName),a.personalMessage&&(p.PersonalMessage=a.personalMessage)),this._bagApiService.request(g,p).then(function(e){return c.notifyBagUpdatedComplete(this,"updateVoucher",e),e}.bind(this)).catch(function(e){throw this._handleBagDoesNotExist(e,d.customerUniqueId),e}.bind(this))}.bind(this))};var E=function(e,t){return this._init().then(this._prepareBag.bind(this)).then(function(n){var i={bagId:n.bagId},o=s.createRoute("addSubscription",i).withExpansions(b(t)).withParam("lang",this._context.language);return this._bagApiService.request(o,{SubscriptionId:e}).then(function(e){return c.notifyBagUpdatedComplete(this,"addSubscription",e),e}.bind(this)).catch(function(e){throw this._handleBagDoesNotExist(e,n.customerUniqueId),e}.bind(this))}.bind(this))};function w(e,t){var n=r.readCookie(e),i=r.readCookie(t);return!(!n||!i||"null"===n||"null"===i)}function U(e,t,n){return new Promise(function(i,o){var r=this._context.currency;t!==r?this.updateCurrency(r,n).then((function(e){i(e)})).catch((function(e){o(e)})):i(e)}.bind(this))}function x(e){return Promise.resolve(e&&e.bag&&e.bag.summary?e.bag.summary:e)}S.prototype.addSubscription=function(e,t){return new Promise(function(n,i){var o=E.bind(this,e,t);o().then(n).catch(function(e){this._bagDoesNotExist(e)?o().then(n).catch(i):i(e)}.bind(this))}.bind(this))},S.prototype._saveGoogleAnalyticsClientId=function(){return p.ga&&p.ga(function(e){var t=e.get("clientId");r.writeCookie(this._googleAnalyticsClientIdCookieName,t)}.bind(this)),!0},S.prototype.startCheckout=function(){return new Promise(function(e,t){this._init().then(this._ensureCheckoutValues.bind(this)).then(function(e){this._invalidateCaches(e.customerUniqueId)}.bind(this)).then(this._saveGoogleAnalyticsClientId.bind(this)).then(e.bind(this)).catch(t)}.bind(this))},S.prototype._ensureCheckoutValues=function(e){return new Promise(function(t,n){w(this._bagIdCookieKey,this._bagOriginCookieKey)?t(e):this.getBag().then(function(){if(w(this._bagIdCookieKey,this._bagOriginCookieKey))t(e);else{var i=function(e,t){var n=r.readCookie(e),i=r.readCookie(t),o=!!n&&"null"!==n,a=!!i&&"null"!==i,s="StartCheckout:CookieCheckFailed";return o||a?o&&!a?s="StartCheckout:MissingBagOrigin":!o&&a&&(s="StartCheckout:MissingBagId"):s="StartCheckout:MissingBagOriginAndId",s}(this._bagIdCookieKey,this._bagOriginCookieKey);n(new Error(i))}}.bind(this)).catch((function(e){var t="";"object"===_typeof(e)&&Array.isArray(e.message)&&e.message.length>0&&(t=":"+e.message[0].errorCode),n(new Error("StartCheckout:GetBagFailed"+t))}))}.bind(this))},S.prototype._getUserBagOrReplaceBag=function(e){console.warn("_getUserBagOrReplaceBag");var t,n=this._keyCreator.createPersistedDataKey({customerUniqueId:e,keyName:"summary"}),i=u.getItem(n);return i?t=!i.bagId:(console.warn("has nil bag"),t=!0),t?(console.warn("_invalidateCachesAndCookies 0"),this._invalidateCachesAndCookies(),this.getBagSummary()):this.getBagById(i.bagId)},S.prototype._handlePendingHotProduct=function(){return this._init().then(function(){var e=window.localStorage.getItem("pendingHotProductId"),t=JSON.parse(e),n=(new Date).getTime();if(t){if(n>=t.setTime+36e5)return window.localStorage.removeItem("pendingHotProductId");a.isAuthenticated().then(function(e){e&&(t.savedItemId?this.moveToBag({variantId:t.variantId,savedItemId:t.savedItemId,seller:t.seller},void 0,{initiator:"bagSdk"}):this.addVariant({variantId:t.variantId,seller:t.seller},void 0,{initiator:"bagSdk"})),window.localStorage.removeItem("pendingHotProductId")}.bind(this))}}.bind(this))},S.prototype._handleLogin=function(){return a.customerUniqueId().then(function(e){var t=this._keyCreator.createPersistedDataKey({customerUniqueId:e,keyName:"isLoggedIn"}),n=u.getItem(t);return u.setItem(t,!0,3600),n?Promise.resolve():this._getUserBagOrReplaceBag(e)}.bind(this))},S.prototype._handleLogout=function(){this._memoryCache.application.clear(),this._invalidateCachesAndCookies(),r.writeCookie(this._keyStoreDataVersionKey,"null",-1)},S.prototype._validateBagCurrency=function(e,t){return U.call(this,t,t.bag.currency,e)},S.prototype._validateBagSummaryCurrency=function(e){return this._init().then(function(t){return U.call(this,e,e.currency).then(x).then(function(e){return null===e?this._getCachedSummary(t.customerUniqueId):e}.bind(this))}.bind(this))},p.asos=p.asos||{},p.asos.commerce=p.asos.commerce||{};var A=null;return p.asos.commerce.bagSdk={getInstance:function(n,i){!function(e){if(!e)throw new l("context is required");if(!0===e.enableStoreBasedOperation){if(e.keyStoreDataversion)throw new l("invalid use of context.keyStoreDataversion")}else if(!e.keyStoreDataversion)throw new l("context.keyStoreDataversion is required");["storeId","country","originCountry","currency","language","sizeSchema"].forEach((function(t){if(!e[t])throw new l("context."+t+" is required")}))}(n);var o=m.extend({},n,{currency:n.currency});if(A){var r=m.extend({},i);if(function(e){for(var t in e)null===e[t]&&delete e[t]}(r),r=m.extend({},t,r),d.areContextsEqual(o,A._context)&&d.areConfigurationsEqual(r,e))return A;throw new f}return m.extend(e,t,i),A=new S(o),p.asos.commerce._bagSdkInstance=A,g.trigger("bagSdk:instanceReady"),g.bagSdkInstantiated=!0,A}},p.asos.commerce.bagSdk}));